                    self.config.problem_type = "single_label_classification"
                else:
                    self.config.problem_type = "multi_label_classification"

            if self.config.problem_type == "regression":
                loss_fct = MSELoss()
                if self.config.num_labels == 1:
                    loss = loss_fct(logits.squeeze(), labels.squeeze())
                else:
                    loss = loss_fct(logits, labels)
            elif self.config.problem_type == "single_label_classification":
                loss_fct = CrossEntropyLoss()
                loss = loss_fct(logits.view(-1, self.config.num_labels), labels.view(-1))
            elif self.config.problem_type == "multi_label_classification":
                loss_fct = BCEWithLogitsLoss()
                loss = loss_fct(logits, labels)
        if not return_dict:
            output = (logits,) + outputs[1:]
            return ((loss,) + output) if loss is not None else output

        return Seq2SeqSequenceClassifierOutput(
            loss=loss,
            logits=logits,
            past_key_values=outputs.past_key_values,
            decoder_hidden_states=outputs.decoder_hidden_states,
            decoder_attentions=outputs.decoder_attentions,
            cross_attentions=outputs.cross_attentions,
            encoder_last_hidden_state=outputs.encoder_last_hidden_state,
            encoder_hidden_states=outputs.encoder_hidden_states,
            encoder_attentions=outputs.encoder_attentions,
        )


@auto_docstring
class BigBirdPegasusForQuestionAnswering(BigBirdPegasusPreTrainedModel):
    _tied_weights_keys = ["encoder.embed_tokens.weight", "decoder.embed_tokens.weight"]

    def __init__(self, config):
        super().__init__(config)

        config.num_labels = 2
        self.num_labels = config.num_labels

        self.model = BigBirdPegasusModel(config)
        self.qa_outputs = nn.Linear(config.hidden_size, config.num_labels)

        # Initialize weights and apply final processing
        self.post_init()

    @auto_docstring
    def forward(
        self,
        input_ids: Optional[torch.Tensor] = None,
        attention_mask: Optional[torch.Tensor] = None,
        decoder_input_ids: Optional[torch.LongTensor] = None,
        decoder_attention_mask: Optional[torch.LongTensor] = None,
        head_mask: Optional[torch.Tensor] = None,
        decoder_head_mask: Optional[torch.Tensor] = None,
        cross_attn_head_mask: Optional[torch.Tensor] = None,
        encoder_outputs: Optional[list[torch.FloatTensor]] = None,
        start_positions: Optional[torch.LongTensor] = None,
        end_positions: Optional[torch.LongTensor] = None,
        inputs_embeds: Optional[torch.FloatTensor] = None,
        decoder_inputs_embeds: Optional[torch.FloatTensor] = None,
        use_cache: Optional[bool] = None,
        output_attentions: Optional[bool] = None,
        output_hidden_states: Optional[bool] = None,
        return_dict: Optional[bool] = None,
        cache_position: Optional[torch.LongTensor] = None,
    ) -> Union[tuple, Seq2SeqQuestionAnsweringModelOutput]:
        r"""
        decoder_input_ids (`torch.LongTensor` of shape `(batch_size, target_sequence_length)`, *optional*):
            Provide for translation and summarization training. By default, the model will create this tensor by
            shifting the `input_ids` to the right, following the paper.
        decoder_attention_mask (`torch.LongTensor` of shape `(batch_size, target_sequence_length)`, *optional*):
            Default behavior: generate a tensor that ignores pad tokens in `decoder_input_ids`. Causal mask will also
            be used by default.

            If you want to change padding behavior, you should read
            [`modeling_bigbird_pegasus._prepare_decoder_attention_mask`] and modify to your needs. See diagram 1 in
            [the paper](https://huggingface.co/papers/1910.13461) for more information on the default strategy.
        decoder_head_mask (`torch.Tensor` of shape `(num_layers, num_heads)`, *optional*):
            Mask to nullify selected heads of the attention modules in the decoder. Mask values selected in `[0, 1]`:

            - 1 indicates the head is **not masked**,
            - 0 indicates the head is **masked**.
        """
        return_dict = return_dict if return_dict is not None else self.config.use_return_dict
        if start_positions is not None and end_positions is not None:
            use_cache = False

        outputs = self.model(
            input_ids,
            attention_mask=attention_mask,
            decoder_input_ids=decoder_input_ids,
            decoder_attention_mask=decoder_attention_mask,
            head_mask=head_mask,
            decoder_head_mask=decoder_head_mask,
            cross_attn_head_mask=cross_attn_head_mask,
            encoder_outputs=encoder_outputs,
            inputs_embeds=inputs_embeds,
            decoder_inputs_embeds=decoder_inputs_embeds,
            use_cache=use_cache,
            output_attentions=output_attentions,
            output_hidden_states=output_hidden_states,
            return_dict=return_dict,
            cache_position=cache_position,
        )

        sequence_output = outputs[0]

        logits = self.qa_outputs(sequence_output)
        start_logits, end_logits = logits.split(1, dim=-1)
        start_logits = start_logits.squeeze(-1).contiguous()
        end_logits = end_logits.squeeze(-1).contiguous()

        total_loss = None
        if start_positions is not None and end_positions is not None:
            # If we are on multi-GPU, split add a dimension
            if len(start_positions.size()) > 1:
                start_positions = start_positions.squeeze(-1)
            if len(end_positions.size()) > 1:
                end_positions = end_positions.squeeze(-1)
            # sometimes the start/end positions are outside our model inputs, we ignore these terms
            ignored_index = start_logits.size(1)
            start_positions = start_positions.clamp(0, ignored_index)
            end_positions = end_positions.clamp(0, ignored_index)

            loss_fct = CrossEntropyLoss(ignore_index=ignored_index)
            start_loss = loss_fct(start_logits, start_positions)
            end_loss = loss_fct(end_logits, end_positions)
            total_loss = (start_loss + end_loss) / 2

        if not return_dict:
            output = (
                start_logits,
                end_logits,
            ) + outputs[1:]
            return ((total_loss,) + output) if total_loss is not None else output

        return Seq2SeqQuestionAnsweringModelOutput(
            loss=total_loss,
            start_logits=start_logits,
            end_logits=end_logits,
            past_key_values=outputs.past_key_values,
            decoder_hidden_states=outputs.decoder_hidden_states,
            decoder_attentions=outputs.decoder_attentions,
            cross_attentions=outputs.cross_attentions,
            encoder_last_hidden_state=outputs.encoder_last_hidden_state,
            encoder_hidden_states=outputs.encoder_hidden_states,
            encoder_attentions=outputs.encoder_attentions,
        )


# Copied from transformers.models.pegasus.modeling_pegasus.PegasusDecoderWrapper with Pegasus->BigBirdPegasus
class BigBirdPegasusDecoderWrapper(BigBirdPegasusPreTrainedModel):
    """
    This wrapper class is a helper class to correctly load pretrained checkpoints when the causal language model is
    used in combination with the [`EncoderDecoderModel`] framework.
    """

    def __init__(self, config):
        super().__init__(config)
        self.decoder = BigBirdPegasusDecoder(config)

    def forward(self, *args, **kwargs):
        return self.decoder(*args, **kwargs)


class BigBirdPegasusForCausalLM(BigBirdPegasusPreTrainedModel, GenerationMixin):
    _tied_weights_keys = ["lm_head.weight"]

    def __init__(self, config):
        config = copy.deepcopy(config)
        config.is_decoder = True
        config.is_encoder_decoder = False
        super().__init__(config)
        self.model = BigBirdPegasusDecoderWrapper(config)

        self.lm_head = nn.Linear(config.hidden_size, config.vocab_size, bias=False)

        # Initialize weights and apply final processing
        self.post_init()

    def get_input_embeddings(self):
        return self.model.decoder.embed_tokens

    def set_input_embeddings(self, value):
        self.model.decoder.embed_tokens = value

    def get_output_embeddings(self):
        return self.lm_head

    def set_output_embeddings(self, new_embeddings):
        self.lm_head = new_embeddings

    def set_decoder(self, decoder):
        self.model.decoder = decoder

    def get_decoder(self):
        return self.model.decoder

    @auto_docstring
    def forward(
        self,
        input_ids: Optional[torch.LongTensor] = None,
        attention_mask: Optional[torch.Tensor] = None,
        encoder_hidden_states: Optional[torch.FloatTensor] = None,
        encoder_attention_mask: Optional[torch.FloatTensor] = None,
        head_mask: Optional[torch.Tensor] = None,
        cross_attn_head_mask: Optional[torch.Tensor] = None,
        past_key_values: Optional[tuple[tuple[torch.Tensor]]] = None,
        inputs_embeds: Optional[torch.FloatTensor] = None,
        labels: Optional[torch.LongTensor] = None,
        use_cache: Optional[bool] = None,
        output_attentions: Optional[bool] = None,
        output_hidden_states: Optional[bool] = None,
        return_dict: Optional[bool] = None,
        cache_position: Optional[torch.LongTensor] = None,
    ) -> Union[tuple, CausalLMOutputWithCrossAttentions]:
        r"""
        cross_attn_head_mask (`torch.Tensor` of shape `(decoder_layers, decoder_attention_heads)`, *optional*):
            Mask to nullify selected heads of the cross-attention modules. Mask values selected in `[0, 1]`:

            - 1 indicates the head is **not masked**,
            - 0 indicates the head is **masked**.
        labels (`torch.LongTensor` of shape `(batch_size, sequence_length)`, *optional*):
            Labels for computing the masked language modeling loss. Indices should either be in `[0, ...,
            config.vocab_size]` or -100 (see `input_ids` docstring). Tokens with indices set to `-100` are ignored
            (masked), the loss is only computed for the tokens with labels in `[0, ..., config.vocab_size]`.

        Example:

        ```python
        >>> from transformers import AutoTokenizer, BigBirdPegasusForCausalLM

        >>> tokenizer = AutoTokenizer.from_pretrained("google/bigbird-pegasus-large-arxiv")
        >>> model = BigBirdPegasusForCausalLM.from_pretrained(
        ...     "google/bigbird-pegasus-large-arxiv", add_cross_attention=False
        ... )
        >>> assert model.config.is_decoder, f"{model.__class__} has to be configured as a decoder."
        >>> inputs = tokenizer("Hello, my dog is cute", return_tensors="pt")
        >>> outputs = model(**inputs)

        >>> logits = outputs.logits
        ```"""

        output_attentions = output_attentions if output_attentions is not None else self.config.output_attentions
        output_hidden_states = (
            output_hidden_states if output_hidden_states is not None else self.config.output_hidden_states
        )
        return_dict = return_dict if return_dict is not None else self.config.use_return_dict

        # decoder outputs consists of (dec_features, layer_state, dec_hidden, dec_attn)
        outputs = self.model.decoder(
            input_ids=input_ids,
            attention_mask=attention_mask,
            encoder_hidden_states=encoder_hidden_states,
            encoder_attention_mask=encoder_attention_mask,
            head_mask=head_mask,
            cross_attn_head_mask=cross_attn_head_mask,
            past_key_values=past_key_values,
            inputs_embeds=inputs_embeds,
            use_cache=use_cache,
            output_attentions=output_attentions,
            output_hidden_states=output_hidden_states,
            return_dict=return_dict,
            cache_position=cache_position,
        )

        logits = self.lm_head(outputs[0])

        loss = None
        if labels is not None:
            loss_fct = CrossEntropyLoss()
            loss = loss_fct(logits.view(-1, self.config.vocab_size), labels.view(-1))

        if not return_dict:
            output = (logits,) + outputs[1:]
            return (loss,) + output if loss is not None else output

        return CausalLMOutputWithCrossAttentions(
            loss=loss,
            logits=logits,
            past_key_values=outputs.past_key_values,
            hidden_states=outputs.hidden_states,
            attentions=outputs.attentions,
            cross_attentions=outputs.cross_attentions,
        )

    @staticmethod
    def _reorder_cache(past_key_values, beam_idx):
        reordered_past = ()
        for layer_past in past_key_values:
            reordered_past += (
                tuple(past_state.index_select(0, beam_idx.to(past_state.device)) for past_state in layer_past),
            )
        return reordered_past


__all__ = [
    "BigBirdPegasusForCausalLM",
    "BigBirdPegasusForConditionalGeneration",
    "BigBirdPegasusForQuestionAnswering",
    "BigBirdPegasusForSequenceClassification",
    "BigBirdPegasusModel",
    "BigBirdPegasusPreTrainedModel",
]
 a   t   i   o   n       a   n   d   /   o   r       o   t   h   e   r       m   a   t   e   r   i   a   l   s       p   r   o   v   i   d   e   d   
                                                                   w   i   t   h       t   h   e       d   i   s   t   r   i   b   u   t   i   o   n   .   
                                       
                                                       *       N   e   i   t   h   e   r       t   h   e       n   a   m   e       o   f       t   h   e       N   u   m   P   y       D   e   v   e   l   o   p   e   r   s       n   o   r       t   h   e       n   a   m   e   s       o   f       a   n   y   
                                                                   c   o   n   t   r   i   b   u   t   o   r   s       m   a   y       b   e       u   s   e   d       t   o       e   n   d   o   r   s   e       o   r       p   r   o   m   o   t   e       p   r   o   d   u   c   t   s       d   e   r   i   v   e   d   
                                                                   f   r   o   m       t   h   i   s       s   o   f   t   w   a   r   e       w   i   t   h   o   u   t       s   p   e   c   i   f   i   c       p   r   i   o   r       w   r   i   t   t   e   n       p   e   r   m   i   s   s   i   o   n   .   
                                       
                                       T   H   I   S       S   O   F   T   W   A   R   E       I   S       P   R   O   V   I   D   E   D       B   Y       T   H   E       C   O   P   Y   R   I   G   H   T       H   O   L   D   E   R   S       A   N   D       C   O   N   T   R   I   B   U   T   O   R   S   
                                       "   A   S       I   S   "       A   N   D       A   N   Y       E   X   P   R   E   S   S       O   R       I   M   P   L   I   E   D       W   A   R   R   A   N   T   I   E   S   ,       I   N   C   L   U   D   I   N   G   ,       B   U   T       N   O   T   
                                       L   I   M   I   T   E   D       T   O   ,       T   H   E       I   M   P   L   I   E   D       W   A   R   R   A   N   T   I   E   S       O   F       M   E   R   C   H   A   N   T   A   B   I   L   I   T   Y       A   N   D       F   I   T   N   E   S   S       F   O   R   
                                       A       P   A   R   T   I   C   U   L   A   R       P   U   R   P   O   S   E       A   R   E       D   I   S   C   L   A   I   M   E   D   .       I   N       N   O       E   V   E   N   T       S   H   A   L   L       T   H   E       C   O   P   Y   R   I   G   H   T   
                                       O   W   N   E   R       O   R       C   O   N   T   R   I   B   U   T   O   R   S       B   E       L   I   A   B   L   E       F   O   R       A   N   Y       D   I   R   E   C   T   ,       I   N   D   I   R   E   C   T   ,       I   N   C   I   D   E   N   T   A   L   ,   
                                       S   P   E   C   I   A   L   ,       E   X   E   M   P   L   A   R   Y   ,       O   R       C   O   N   S   E   Q   U   E   N   T   I   A   L       D   A   M   A   G   E   S       (   I   N   C   L   U   D   I   N   G   ,       B   U   T       N   O   T   
                                       L   I   M   I   T   E   D       T   O   ,       P   R   O   C   U   R   E   M   E   N   T       O   F       S   U   B   S   T   I   T   U   T   E       G   O   O   D   S       O   R       S   E   R   V   I   C   E   S   ;       L   O   S   S       O   F       U   S   E   ,   
                                       D   A   T   A   ,       O   R       P   R   O   F   I   T   S   ;       O   R       B   U   S   I   N   E   S   S       I   N   T   E   R   R   U   P   T   I   O   N   )       H   O   W   E   V   E   R       C   A   U   S   E   D       A   N   D       O   N       A   N   Y   
                                       T   H   E   O   R   Y       O   F       L   I   A   B   I   L   I   T   Y   ,       W   H   E   T   H   E   R       I   N       C   O   N   T   R   A   C   T   ,       S   T   R   I   C   T       L   I   A   B   I   L   I   T   Y   ,       O   R       T   O   R   T   
                                       (   I   N   C   L   U   D   I   N   G       N   E   G   L   I   G   E   N   C   E       O   R       O   T   H   E   R   W   I   S   E   )       A   R   I   S   I   N   G       I   N       A   N   Y       W   A   Y       O   U   T       O   F       T   H   E       U   S   E   
                                       O   F       T   H   I   S       S   O   F   T   W   A   R   E   ,       E   V   E   N       I   F       A   D   V   I   S   E   D       O   F       T   H   E       P   O   S   S   I   B   I   L   I   T   Y       O   F       S   U   C   H       D   A   M   A   G   E   .   
                                                                                                                                                                           A   p   a   c   h   e       L   i   c   e   n   s   e   
                                                                                                                                                   V   e   r   s   i   o   n       2   .   0   ,       J   a   n   u   a   r   y       2   0   0   4   
                                                                                                                                       h   t   t   p   :   /   /   w   w   w   .   a   p   a   c   h   e   .   o   r   g   /   l   i   c   e   n   s   e   s   /   
                                       
                                                   T   E   R   M   S       A   N   D       C   O   N   D   I   T   I   O   N   S       F   O   R       U   S   E   ,       R   E   P   R   O   D   U   C   T   I   O   N   ,       A   N   D       D   I   S   T   R   I   B   U   T   I   O   N   
                                       
                                                   1   .       D   e   f   i   n   i   t   i   o   n   s   .   
                                       
                                                               "   L   i   c   e   n   s   e   "       s   h   a   l   l       m   e   a   n       t   h   e       t   e   r   m   s       a   n   d       c   o   n   d   i   t   i   o   n   s       f   o   r       u   s   e   ,       r   e   p   r   o   d   u   c   t   i   o   n   ,   
                                                               a   n   d       d   i   s   t   r   i   b   u   t   i   o   n       a   s       d   e   f   i   n   e   d       b   y       S   e   c   t   i   o   n   s       1       t   h   r   o   u   g   h       9       o   f       t   h   i   s       d   o   c   u   m   e   n   t   .   
                                       
                                                               "   L   i   c   e   n   s   o   r   "       s   h   a   l   l       m   e   a   n       t   h   e       c   o   p   y   r   i   g   h   t       o   w   n   e   r       o   r       e   n   t   i   t   y       a   u   t   h   o   r   i   z   e   d       b   y   
                                                               t   h   e       c   o   p   y   r   i   g   h   t       o   w   n   e   r       t   h   a   t       i   s       g   r   a   n   t   i   n   g       t   h   e       L   i   c   e   n   s   e   .   
                                       
                                                               "   L   e   g   a   l       E   n   t   i   t   y   "       s   h   a   l   l       m   e   a   n       t   h   e       u   n   i   o   n       o   f       t   h   e       a   c   t   i   n   g       e   n   t   i   t   y       a   n   d       a   l   l   
                                                               o   t   h   e   r       e   n   t   i   t   i   e   s       t   h   a   t       c   o   n   t   r   o   l   ,       a   r   e       c   o   n   t   r   o   l   l   e   d       b   y   ,       o   r       a   r   e       u   n   d   e   r       c   o   m   m   o   n   
                                                               c   o   n   t   r   o   l       w   i   t   h       t   h   a   t       e   n   t   i   t   y   .       F   o   r       t   h   e       p   u   r   p   o   s   e   s       o   f       t   h   i   s       d   e   f   i   n   i   t   i   o   n   ,   
                                                               "   c   o   n   t   r   o   l   "       m   e   a   n   s       (   i   )       t   h   e       p   o   w   e   r   ,       d   i   r   e   c   t       o   r       i   n   d   i   r   e   c   t   ,       t   o       c   a   u   s   e       t   h   e   
                                                               d   i   r   e   c   t   i   o   n       o   r       m   a   n   a   g   e   m   e   n   t       o   f       s   u   c   h       e   n   t   i   t   y   ,       w   h   e   t   h   e   r       b   y       c   o   n   t   r   a   c   t       o   r   
                                                               o   t   h   e   r   w   i   s   e   ,       o   r       (   i   i   )       o   w   n   e   r   s   h   i   p       o   f       f   i   f   t   y       p   e   r   c   e   n   t       (   5   0   %   )       o   r       m   o   r   e       o   f       t   h   e   
                                                               o   u   t   s   t   a   n   d   i   n   g       s   h   a   r   e   s   ,       o   r       (   i   i   i   )       b   e   n   e   f   i   c   i   a   l       o   w   n   e   r   s   h   i   p       o   f       s   u   c   h       e   n   t   i   t   y   .   
                                       
                                                               "   Y   o   u   "       (   o   r       "   Y   o   u   r   "   )       s   h   a   l   l       m   e   a   n       a   n       i   n   d   i   v   i   d   u   a   l       o   r       L   e   g   a   l       E   n   t   i   t   y   
                                                               e   x   e   r   c   i   s   i   n   g       p   e   r   m   i   s   s   i   o   n   s       g   r   a   n   t   e   d       b   y       t   h   i   s       L   i   c   e   n   s   e   .   
                                       
                                                               "   S   o   u   r   c   e   "       f   o   r   m       s   h   a   l   l       m   e   a   n       t   h   e       p   r   e   f   e   r   r   e   d       f   o   r   m       f   o   r       m   a   k   i   n   g       m   o   d   i   f   i   c   a   t   i   o   n   s   ,   
                                                               i   n   c   l   u   d   i   n   g       b   u   t       n   o   t       l   i   m   i   t   e   d       t   o       s   o   f   t   w   a   r   e       s   o   u   r   c   e       c   o   d   e   ,       d   o   c   u   m   e   n   t   a   t   i   o   n   
                                                               s   o   u   r   c   e   ,       a   n   d       c   o   n   f   i   g   u   r   a   t   i   o   n       f   i   l   e   s   .   
                                       
                                                               "   O   b   j   e   c   t   "       f   o   r   m       s   h   a   l   l       m   e   a   n       a   n   y       f   o   r   m       r   e   s   u   l   t   i   n   g       f   r   o   m       m   e   c   h   a   n   i   c   a   l   
                                                               t   r   a   n   s   f   o   r   m   a   t   i   o   n       o   r       t   r   a   n   s   l   a   t   i   o   n       o   f       a       S   o   u   r   c   e       f   o   r   m   ,       i   n   c   l   u   d   i   n   g       b   u   t   
                                                               n   o   t       l   i   m   i   t   e   d       t   o       c   o   m   p   i   l   e   d       o   b   j   e   c   t       c   o   d   e   ,       g   e   n   e   r   a   t   e   d       d   o   c   u   m   e   n   t   a   t   i   o   n   ,   
                                                               a   n   d       c   o   n   v   e   r   s   i   o   n   s       t   o       o   t   h   e   r       m   e   d   i   a       t   y   p   e   s   .   
                                       
                                                               "   W   o   r   k   "       s   h   a   l   l       m   e   a   n       t   h   e       w   o   r   k       o   f       a   u   t   h   o   r   s   h   i   p   ,       w   h   e   t   h   e   r       i   n       S   o   u   r   c   e       o   r   
                                                               O   b   j   e   c   t       f   o   r   m   ,       m   a   d   e       a   v   a   i   l   a   b   l   e       u   n   d   e   r       t   h   e       L   i   c   e   n   s   e   ,       a   s       i   n   d   i   c   a   t   e   d       b   y       a   
                                                               c   o   p   y   r   i   g   h   t       n   o   t   i   c   e       t   h   a   t       i   s       i   n   c   l   u   d   e   d       i   n       o   r       a   t   t   a   c   h   e   d       t   o       t   h   e       w   o   r   k   
                                                               (   a   n       e   x   a   m   p   l   e       i   s       p   r   o   v   i   d   e   d       i   n       t   h   e       A   p   p   e   n   d   i   x       b   e   l   o   w   )   .   
                                       
                                                               "   D   e   r   i   v   a   t   i   v   e       W   o   r   k   s   "       s   h   a   l   l       m   e   a   n       a   n   y       w   o   r   k   ,       w   h   e   t   h   e   r       i   n       S   o   u   r   c   e       o   r       O   b   j   e   c   t   
                                                               f   o   r   m   ,       t   h   a   t       i   s       b   a   s   e   d       o   n       (   o   r       d   e   r   i   v   e   d       f   r   o   m   )       t   h   e       W   o   r   k       a   n   d       f   o   r       w   h   i   c   h       t   h   e   
                                                               e   d   i   t   o   r   i   a   l       r   e   v   i   s   i   o   n   s   ,       a   n   n   o   t   a   t   i   o   n   s   ,       e   l   a   b   o   r   a   t   i   o   n   s   ,       o   r       o   t   h   e   r       m   o   d   i   f   i   c   a   t   i   o   n   s   
                                                               r   e   p   r   e   s   e   n   t   ,       a   s       a       w   h   o   l   e   ,       a   n       o   r   i   g   i   n   a   l       w   o   r   k       o   f       a   u   t   h   o   r   s   h   i   p   .       F   o   r       t   h   e       p   u   r   p   o   s   e   s   
                                                               o   f       t   h   i   s       L   i   c   e   n   s   e   ,       D   e   r   i   v   a   t   i   v   e       W   o   r   k   s       s   h   a   l   l       n   o   t       i   n   c   l   u   d   e       w   o   r   k   s       t   h   a   t       r   e   m   a   i   n   
                                                               s   e   p   a   r   a   b   l   e       f   r   o   m   ,       o   r       m   e   r   e   l   y       l   i   n   k       (   o   r       b   i   n   d       b   y       n   a   m   e   )       t   o       t   h   e       i   n   t   e   r   f   a   c   e   s       o   f   ,   
                                                               t   h   e       W   o   r   k       a   n   d       D   e   r   i   v   a   t   i   v   e       W   o   r   k   s       t   h   e   r   e   o   f   .   
                                       
                                                               "   C   o   n   t   r   i   b   u   t   i   o   n   "       s   h   a   l   l       m   e   a   n       a   n   y       w   o   r   k       o   f       a   u   t   h   o   r   s   h   i   p   ,       i   n   c   l   u   d   i   n   g   
                                                               t   h   e       o   r   i   g   i   n   a   l       v   e   r   s   i   o   n       o   f       t   h   e       W   o   r   k       a   n   d       a   n   y       m   o   d   i   f   i   c   a   t   i   o   n   s       o   r       a   d   d   i   t   i   o   n   s   
                                                               t   o       t   h   a   t       W   o   r   k       o   r       D   e   r   i   v   a   t   i   v   e       W   o   r   k   s       t   h   e   r   e   o   f   ,       t   h   a   t       i   s       i   n   t   e   n   t   i   o   n   a   l   l   y   
                                                               s   u   b   m   i   t   t   e   d       t   o       L   i   c   e   n   s   o   r       f   o   r       i   n   c   l   u   s   i   o   n       i   n       t   h   e       W   o   r   k       b   y       t   h   e       c   o   p   y   r   i   g   h   t       o   w   n   e   r   
                                                               o   r       b   y       a   n       i   n   d   i   v   i   d   u   a   l       o   r       L   e   g   a   l       E   n   t   i   t   y       a   u   t   h   o   r   i   z   e   d       t   o       s   u   b   m   i   t       o   n       b   e   h   a   l   f       o   f   
                                                               t   h   e       c   o   p   y   r   i   g   h   t       o   w   n   e   r   .       F   o   r       t   h   e       p   u   r   p   o   s   e   s       o   f       t   h   i   s       d   e   f   i   n   i   t   i   o   n   ,       "   s   u   b   m   i   t   t   e   d   "   
                                                               m   e   a   n   s       a   n   y       f   o   r   m       o   f       e   l   e   c   t   r   o   n   i   c   ,       v   e   r   b   a   l   ,       o   r       w   r   i   t   t   e   n       c   o   m   m   u   n   i   c   a   t   i   o   n       s   e   n   t   
                                                               t   o       t   h   e       L   i   c   e   n   s   o   r       o   r       i   t   s       r   e   p   r   e   s   e   n   t   a   t   i   v   e   s   ,       i   n   c   l   u   d   i   n   g       b   u   t       n   o   t       l   i   m   i   t   e   d       t   o   
                                                               c   o   m   m   u   n   i   c   a   t   i   o   n       o   n       e   l   e   c   t   r   o   n   i   c       m   a   i   l   i   n   g       l   i   s   t   s   ,       s   o   u   r   c   e       c   o   d   e       c   o   n   t   r   o   l       s   y   s   t   e   m   s   ,   
                                                               a   n   d       i   s   s   u   e       t   r   a   c   k   i   n   g       s   y   s   t   e   m   s       t   h   a   t       a   r   e       m   a   n   a   g   e   d       b   y   ,       o   r       o   n       b   e   h   a   l   f       o   f   ,       t   h   e   
                                                               L   i   c   e   n   s   o   r       f   o   r       t   h   e       p   u   r   p   o   s   e       o   f       d   i   s   c   u   s   s   i   n   g       a   n   d               à˜    Šª      ÿÿÿÿÿÿÿÿ°       H€}¸                  Šª      #                                                                   ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö 
   #                                               T   h   i   s       f   i   l   e       w   a   s       a   u   t   o   m   a   t   i   c   a   l   l   y       g   e   n   e   r   a   t   e   d       f   r   o   m       s   r   c   /   t   r   a   n   s   f   o   r   m   e   r   s   /   m   o   d   e   l   s   /   b   i   o   g   p   t   /   m   o   d   u   l   a   r   _   b   i   o   g   p   t   .   p   y   .   
   #                                                               D   o       N   O   T       e   d   i   t       t   h   i   s       f   i   l   e       m   a   n   u   a   l   l   y       a   s       a   n   y       e   d   i   t   s       w   i   l   l       b   e       o   v   e   r   w   r   i   t   t   e   n       b   y       t   h   e       g   e   n   e   r   a   t   i   o   n       o   f   
   #                                                       t   h   e       f   i   l   e       f   r   o   m       t   h   e       m   o   d   u   l   a   r   .       I   f       a   n   y       c   h   a   n   g   e       s   h   o   u   l   d       b   e       d   o   n   e   ,       p   l   e   a   s   e       a   p   p   l   y       t   h   e       c   h   a   n   g   e       t   o       t   h   e   
   #                                                                                                           m   o   d   u   l   a   r   _   b   i   o   g   p   t   .   p   y       f   i   l   e       d   i   r   e   c   t   l   y   .       O   n   e       o   f       o   u   r       C   I       e   n   f   o   r   c   e   s       t   h   i   s   .   
   #                                                                   ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö ¨ö 
   #       c   o   d   i   n   g   =   u   t   f   -   8   
   #       C   o   p   y   r   i   g   h   t       2   0   2   2       T   h   e       H   u   g   g   i   n   g   F   a   c   e       T   e   a   m       a   n   d       M   i   c   r   o   s   o   f   t       R   e   s   e   a   r   c   h       A   I   4   S   c   i   e   n   c   e       A   l   l       r   i   g   h   t   s       r   e   s   e   r   v   e   d   .   
   #   
   #       L   i   c   e   n   s   e   d       u   n   d   e   r       t   h   e       A   p   a   c   h   e       L   i   c   e   n   s   e   ,       V   e   r   s   i   o   n       2   .   0       (   t   h   e       "   L   i   c   e   n   s   e   "   )   ;   
   #       y   o   u       m   a   y       n   o   t       u   s   e       t   h   i   s       f   i   l   e       e   x   c   e   p   t       i   n       c   o   m   p   l   i   a   n   c   e       w   i   t   h       t   h   e       L   i   c   e   n   s   e   .   
   #       Y   o   u       m   a   y       o   b   t   a   i   n       a       c   o   p   y       o   f       t   h   e       L   i   c   e   n   s   e       a   t   
   #   
   #                       h   t   t   p   :   /   /   w   w   w   .   a   p   a   c   h   e   .   o   r   g   /   l   i   c   e   n   s   e   s   /   L   I   C   E   N   S   E   -   2   .   0   
   #   
   #       U   n   l   e   s   s       r   e   q   u   i   r   e   d       b   y       a   p   p   l   i   c   a   b   l   e       l   a   w       o   r       a   g   r   e   e   d       t   o       i   n       w   r   i   t   i   n   g   ,       s   o   f   t   w   a   r   e   
   #       d   i   s   t   r   i   b   u   t   e   d       u   n   d   e   r       t   h   e       L   i   c   e   n   s   e       i   s       d   i   s   t   r   i   b   u   t   e   d       o   n       a   n       "   A   S       I   S   "       B   A   S   I   S   ,   
   #       W   I   T   H   O   U   T       W   A   R   R   A   N   T   I   E   S       O   R       C   O   N   D   I   T   I   O   N   S       O   F       A   N   Y       K   I   N   D   ,       e   i   t   h   e   r       e   x   p   r   e   s   s       o   r       i   m   p   l   i   e   d   .   
   #       S   e   e       t   h   e       L   i   c   e   n   s   e       f   o   r       t   h   e       s   p   e   c   i   f   i   c       l   a   n   g   u   a   g   e       g   o   v   e   r   n   i   n   g       p   e   r   m   i   s   s   i   o   n   s       a   n   d   
   #       l   i   m   i   t   a   t   i   o   n   s       u   n   d   e   r       t   h   e       L   i   c   e   n   s   e   .   
   
   i   m   p   o   r   t       m   a   t   h   
   f   r   o   m       t   y   p   i   n   g       i   m   p   o   r   t       C   a   l   l   a   b   l   e   ,       O   p   t   i   o   n   a   l   ,       U   n   i   o   n   
   
   i   m   p   o   r   t       t   o   r   c   h   
   i   m   p   o   r   t       t   o   r   c   h   .   n   n       a   s       n   n   
   f   r   o   m       t   o   r   c   h   .   n   n       i   m   p   o   r   t       B   C   E   W   i   t   h   L   o   g   i   t   s   L   o   s   s   ,       C   r   o   s   s   E   n   t   r   o   p   y   L   o   s   s   ,       M   S   E   L   o   s   s   
   
   f   r   o   m       .   .   .   a   c   t   i   v   a   t   i   o   n   s       i   m   p   o   r   t       A   C   T   2   F   N   
   f   r   o   m       .   .   .   c   a   c   h   e   _   u   t   i   l   s       i   m   p   o   r   t       C   a   c   h   e   ,       E   n   c   o   d   e   r   D   e   c   o   d   e   r   C   a   c   h   e   
   f   r   o   m       .   .   .   g   e   n   e   r   a   t   i   o   n       i   m   p   o   r   t       G   e   n   e   r   a   t   i   o   n   M   i   x   i   n   
   f   r   o   m       .   .   .   m   o   d   e   l   i   n   g   _   a   t   t   n   _   m   a   s   k   _   u   t   i   l   s       i   m   p   o   r   t       A   t   t   e   n   t   i   o   n   M   a   s   k   C   o   n   v   e   r   t   e   r   
   f   r   o   m       .   .   .   m   o   d   e   l   i   n   g   _   f   l   a   s   h   _   a   t   t   e   n   t   i   o   n   _   u   t   i   l   s       i   m   p   o   r   t       F   l   a   s   h   A   t   t   e   n   t   i   o   n   K   w   a   r   g   s   
   f   r   o   m       .   .   .   m   o   d   e   l   i   n   g   _   l   a   y   e   r   s       i   m   p   o   r   t       G   r   a   d   i   e   n   t   C   h   e   c   k   p   o   i   n   t   i   n   g   L   a   y   e   r   
   f   r   o   m       .   .   .   m   o   d   e   l   i   n   g   _   o   u   t   p   u   t   s       i   m   p   o   r   t       (   
                   B   a   s   e   M   o   d   e   l   O   u   t   p   u   t   W   i   t   h   P   a   s   t   A   n   d   C   r   o   s   s   A   t   t   e   n   t   i   o   n   s   ,   
                   C   a   u   s   a   l   L   M   O   u   t   p   u   t   W   i   t   h   C   r   o   s   s   A   t   t   e   n   t   i   o   n   s   ,   
                   S   e   q   u   